{% extends '/user/base.html' %}
{% block content %}
<div class="text-center">
	<img src="/images/map_cat.png">
	<br>
	<br>
	<p>welcome back, <em><strong>{{ user.name }}</strong></em></p>
</div>
<div style="padding-top: 50px">
	<form id="search" action="/trades/search/simple" method="post" class="form-horizontal" role="form">	
		<div class="form-group">
			<label for="title" class="col-sm-2 control-label">Search for a game!</label>
			<div class="col-sm-9">
				<div class="input-group">
					<span class="input-group-addon">
						<span class="glyphicon glyphicon-search"></span>
					</span>
					<input id="title" name="name" type="text" class="form-control" placeholder="title here">
				</div>
			</div>
			<div class="col-sm-1">
				<button type="submit" class="btn btn-default">search</button>
			</div>
		</div>
	</form>
</div>
<div class="container" style="padding-top: 40px">
	<h3 style="text-align: center">latest trade</h3>
	<div id="trade">
		<div class="trade-block">
			<div class="row">
				<div class="col-md-6">
					<h4><a href="/user/{{ person.key.urlsafe() }}"><img class="display-pic" src="{{ person.pic }}">{{ person.name }}</a></h4>
				</div>
				<div class="col-md-6">
					<div class="trade-menu">
						<ul>
							<li><a class="btn btn-default" href="/trade/{{ trade.key.urlsafe() }}"><span class="glyphicon glyphicon glyphicon-link"></span></a></li>
							<li><div class="trade-date">posted {{ trade.date.strftime('%c') }}</div></li>
						</ul>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-md-6">
					<div class="panel panel-primary">
						<div class="panel-heading">
							<h3 class="panel-title">offering</h3>
						</div>
						{% if own_games|length %}
						<div class="table-responsive">
							<table class="sortable table table-bordered table-striped">
								<thead>
									<tr>
										<th width="70%" style="text-align: left">title</th>
										<th width="20%">platform</th>
										<th class="sorttable_nosort" width="10%">picture</th>
									</tr>
								</thead>
								<tbody>
									{% for game in own_games %}
									<tr id="{{ game.key.urlsafe() }}" class="game" title="{{ game.title }}" data-content="<p>description: {{ game.description or 'none' }}</p>">
										<td width="70%" style="text-align: left">{{ game.title }}</td>
										<td width="20%">{{ game.platform }}</td>
										<td width="10%">
											{% if game.pic %}<a href="{{ game.pic }}" target="_blank"><img src="{{ game.pic }}"></a>{% else %}-{% endif %}
										</td>
									</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
						{% else %}
						<div class="panel-body">
							<div class="alert alert-info">
								no games here!
							</div>
						</div>
						{% endif %}
						{% if trade.topup > 0 %}
						<div class="panel-footer trade-topup">
							<div class="input-group">
								<span class="input-group-addon">topup ${{ trade.topup }}</span>
							</div>
						</div>
						{% endif %}
					</div>
				</div>
				<div class="col-md-6">
					<div class="panel panel-primary">
						<div class="panel-heading">
							<h3 class="panel-title">requesting</h3>
						</div>
						{% if seek_games|length %}
						<div class="table-responsive">
							<table class="sortable table table-bordered table-striped">
								<thead>
									<tr>
										<th width="70%" style="text-align: left">title</th>
										<th width="20%">platform</th>
										<th class="sorttable_nosort" width="10%">picture</th>
									</tr>
								</thead>
								<tbody>
									{% for game in seek_games %}
									<tr id="{{ game.key.urlsafe() }}" class="game" title="{{ game.title }}" data-content="<p>description: {{ game.description or 'none' }}</p>">
										<td width="70%" style="text-align: left">{{ game.title }}</td>
										<td width="20%">{{ game.platform }}</td>
										<td width="10%">
											{% if game.pic %}<a href="{{ game.pic }}" target="_blank"><img src="{{ game.pic }}"></a>{% else %}-{% endif %}
										</td>
									</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
						{% else %}
						<div class="panel-body">
							<div class="alert alert-info">
								no games here!
							</div>
						</div>
						{% endif %}
						{% if trade.topup < 0 %}
						<div class="panel-footer trade-topup">
							<div class="input-group">
								<span class="input-group-addon">topup ${{ -trade.topup }}</span>
							</div>
						</div>
						{% endif %}
					</div>
				</div>
			</div>
			<h4>description</h4>
			<p>{{ trade.description or 'none' }}</p>
		</div>
	</div>
</div>
<script>
	window.onload = function() {
		$('#nav-dashboard').addClass('active');
	}
</script>
<script>
	function getListing() {
		$.ajax({
			type: 'GET',
			url: '/trade/latest',
			success: function(data, textStatus, jqXHR) {
				console.log(data);
				console.log(textStatus);
				console.log(jqXHR);

				$('#trade').fadeOut("slow", function(){
					$('#trade').html(data);
					$('#trade').fadeIn("slow");
				});
			}
		});
	}

	$(document).ready(function() {
		setInterval(function () {
			getListing()
		}, 10000);
	});
</script>

{% endblock %}