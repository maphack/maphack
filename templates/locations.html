{% extends "base.html" %}
{% block content %}
<div class="page-header">
	<h1>locations
		<a class="btn btn-default" href="/locations/add">
			<span class="glyphicon glyphicon-plus"></span>
		</a>
	</h1>
</div>
<div id="alerts">
	{% if not locations.count() %}
	<div class="alert alert-info">
		no locations added! add the locations you want to trade at.
	</div>
	{% endif %}
</div>
{% if locations.count() %}
<div class="table-responsive">
	<table id="locations" class="sortable table table-bordered table-striped">
		<thead>
			<tr>
				<th width = "20%">name</th>
				<th width = "50%" style="text-align: left">address</th>
				<th width = "10%">latitude</th>
				<th width = "10%">longitude</th>
				<th class="sorttable_nosort" width = "10%">delete</th>
			</tr>
		</thead>
		<tbody>
			{% for location in locations %}
			<tr id="{{ location.key.id() }}">
				<td width = "20%"><a href="/locations/view?location_id={{ location.key.id() }}">{{ location.name }}</a></td>
				<td width = "50%" style="text-align: left">{{ location.address }}</td>
				<td width = "10%">{{ location.geopt.lat }}</td>
				<td width = "10%">{{ location.geopt.lon }}</td>
				<td width = "10%">
					<button id="{{ location.key.id() }}" type="button" class="btn btn-default delete">
						<span class="glyphicon glyphicon-trash"></span>
					</button>
				</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
</div>
{% endif %}
<script>
	$('.delete').click(function(event) {
		clearAlerts();

		var location_id = parseInt(this.id);

		$.ajax({
			type: 'POST',
			url: '/locations/delete',
			data: {location_id: location_id},
			success: function(data, textStatus, jqXHR) {
				console.log(data);
				console.log(textStatus);
				console.log(jqXHR);

				$('#alerts').append('<div class="alert alert-success alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>location deleted.</div>');
				alertTimeout(5000);

				$('#' + location_id).remove();
				if ($('#locations tr').length == 1) {
					$('#locations').remove();
					$('#alerts').append('<div class="alert alert-info">no locations added! add the locations you want to trade at.</div>');
				}
			},
			error: function(jqXHR, textStatus, errorThrown) {
				console.log(jqXHR);
				console.log(textStatus);
				console.log(errorThrown);
				var errors = eval(jqXHR.responseText);

				for (var i = 0; i < errors.length; i ++) {
					$('#alerts').append('<div class="alertdiv alert alert-danger alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>' + errors[i] + '</div>');
				}
			}
		});
	});
</script>
<script>
	$('#nav-dash').addClass("active");
	$('#nav-dash-loc').addClass("active");
</script>
{% endblock %}