{% extends "base.html" %}
{% block content %}
<div class="page-header">
	<h1>
		locations
		<a class="btn btn-default" href="/locations/add">
			<span class="glyphicon glyphicon-plus"></span>
		</a>
	</h1>
</div>
<div id="alerts">
	{% if not locations.count() %}
	<div class="alert alert-info">
		no locations added! add the locations you want to trade at.
	</div>
	{% endif %}
</div>
{% if locations.count() %}
<div class="table-responsive">
	<table id="locations" class="sortable table table-bordered table-striped">
		<thead>
			<tr>
				<th width="20%">name</th>
				<th width="50%" style="text-align: left">address</th>
				<th width="10%">latitude</th>
				<th width="10%">longitude</th>
				<th class="sorttable_nosort" width="10%">delete</th>
			</tr>
		</thead>
		<tbody>
			{% for location in locations %}
			<tr id="{{ location.key.urlsafe() }}">
				<td width="20%"><a href="/locations/view/{{ location.key.urlsafe() }}">{{ location.name }}</a></td>
				<td width="50%" style="text-align: left">{{ location.address }}</td>
				<td width="10%">{{ location.geopt.lat }}</td>
				<td width="10%">{{ location.geopt.lon }}</td>
				<td width="10%">
					<button type="button" class="btn btn-default delete" value="{{ location.key.urlsafe() }}">
						<span class="glyphicon glyphicon-trash"></span>
					</button>
				</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
</div>
{% endif %}
<script>
	$('.delete').click(function(event) {
		clearAlerts();

		var location_url = $(this).attr('value');

		$.ajax({
			type: 'POST',
			url: '/locations/delete',
			data: {location_url: location_url},
			success: function(data, textStatus, jqXHR) {
				console.log(data);
				console.log(textStatus);
				console.log(jqXHR);

				$('#alerts').append(alertBootstrap('success', 'location deleted.'));
				alertTimeout(5000);

				$('#' + location_url).remove();

				if ($('#locations tr').length == 1) {
					$('#locations').fadeTo(500, 0).slideUp(500, function() {
						$(this).remove();
					});
					$('#alerts').append(alertBootstrap('info', 'no locations added! add the locations you want to trade at.'));
				}
			},
			error: function(jqXHR, textStatus, errorThrown) {
				console.log(jqXHR);
				console.log(textStatus);
				console.log(errorThrown);
				var errors = eval(jqXHR.responseText);

				for (var i = 0; i < errors.length; i ++) {
					$('#alerts').append(alertBootstrap('danger', errors[i]));
				}
			},
		});
	});
</script>
<script>
	$('#nav-dash').addClass("active");
	$('#nav-dash-loc').addClass("active");
</script>
{% endblock %}