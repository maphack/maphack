{% extends "base.html" %}
{% block content %}
<div class="page-header">
	<h1>add to inventory
		<a class="btn btn-default" href="/inventory">back</a>
	</h1>
</div>
<div id="alerts"></div>
<form id="form" class="form-horizontal" role="form">
	<div class="form-group">
		<label for="title" class="col-sm-2 control-label">title</label>
		<div class="col-sm-10">
			<div class="input-group">
				<span class="input-group-addon">
					<i class="glyphicon glyphicon-book"></i>
				</span>
				<input type="text" class="form-control" id="title" placeholder="title">
			</div>
		</div>
	</div>
	<div class="form-group">
		<label for="platform" class="col-sm-2 control-label">platform</label>
		<div class="col-sm-10">
			<div class="input-group">
				<span class="input-group-addon">
					<i class="glyphicon glyphicon-tower"></i>
				</span>
				<input type="text" class="form-control" id="platform" placeholder="PS4 / XBOX360 / PC etc.">
			</div>
		</div>
	</div>
	<div class="form-group">
		<label for="image url" class="col-sm-2 control-label">picture</label>
		<div class="col-sm-10">
			<div class="input-group">
				<span class="input-group-addon">
					<i class="glyphicon glyphicon-picture"></i>
				</span>
				<input type="text" class="form-control" id="pic" placeholder="image url">
			</div>
		</div>
	</div>
	<div class="form-group">
		<label for="description" class="col-sm-2 control-label">description</label>
		<div class="col-sm-10">
			<div class="input-group">
				<span class="input-group-addon">
					<i class="glyphicon glyphicon-italic"></i>
				</span>
				<textarea class="form-control" id="description" rows="3" placeholder="write a short description of your game (e.g. condition)"></textarea>
			</div>
		</div>
	</div>
	<div class="form-group">
		<div class="col-sm-offset-2 col-sm-10">
			<button id="add" type="button" class="btn btn-default">add</button>
		</div>
	</div>
</form>
<script>
	$("#add").click( function(event) {
		clearAlerts();

		var title = $('#title').val().trim();
		var platform = $('#platform').val().trim();
		var pic = $('#pic').val().trim();
		var description = $('#description').val().trim();

		if (!title) {
			$('#alerts').append('<div class="alertdiv alert alert-danger alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>title cannot be empty.</div>');
		} else if (!platform) {
			$('#alerts').append('<div class="alertdiv alert alert-danger alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>platform cannot be empty.</div>');
		} else {
			$.ajax({
				type: 'POST',
				url: '/inventory/add',
				data: {title: title, platform: platform, pic: pic, description: description},
				success: function(data, textStatus, jqXHR) {
					console.log(data);
					console.log(textStatus);
					console.log(jqXHR);
					
					$('#alerts').append('<div class="alert alert-success"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>' + title + ' added to inventory.</div>');
					alertTimeout(5000);

					$('#form')[0].reset()
				},
				error: function(jqXHR, textStatus, errorThrown) {
					console.log(jqXHR);
					console.log(textStatus);
					console.log(errorThrown);
					var errors = eval(jqXHR.responseText);

					for (var i = 0; i < errors.length; i ++) {
						$('#alerts').append('<div class="alertdiv alert alert-danger alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>' + errors[i] + '</div>');
					}
				}
			});
		}
	});
</script>
<script>
	$('#nav-inv').addClass("active");
</script>
{% endblock %}